# Popup 标签页复制功能使用示例

## 功能概述

Copy as Markdown 扩展的 popup 界面提供了两个主要的标签页复制功能：

1. **复制当前标签页** - 将当前活跃的标签页转换为 Markdown 链接格式
2. **复制所有标签页** - 将当前窗口的所有标签页转换为 Markdown 列表格式

## 使用方法

### 1. 打开 Popup

- 点击浏览器工具栏中的扩展图标
- 或使用快捷键（如果已配置）

### 2. 复制当前标签页

点击 **"复制当前标签页"** 按钮，将当前活跃标签页复制为：

```markdown
[页面标题](页面URL)
```

**示例输出：**
```markdown
[GitHub](https://github.com)
```

### 3. 复制所有标签页

点击 **"复制所有标签页"** 按钮，将当前窗口所有标签页复制为：

```markdown
- [标题1](URL1)
- [标题2](URL2)
- [标题3](URL3)
```

**示例输出：**
```markdown
- [GitHub](https://github.com)
- [Stack Overflow](https://stackoverflow.com)
- [MDN Web Docs](https://developer.mozilla.org)
```

## 功能特性

### 智能过滤
- 自动过滤掉系统页面（如 `chrome://` 和 `chrome-extension://`）
- 只复制有效的网页标签页

### 标题处理
- 自动清理标题中的方括号，避免破坏 Markdown 格式
- 对于无标题的页面，自动使用 "无标题" 作为显示文本

### 用户反馈
- 复制过程中显示加载状态
- 复制成功后显示确认信息
- 复制失败时显示错误提示

### 状态指示
按钮会根据操作状态显示不同的文本和样式：

- **默认状态**: "复制当前标签页" / "复制所有标签页"
- **复制中**: "复制中..." （显示旋转图标）
- **成功**: "已复制!" （显示绿色背景和勾号）
- **失败**: "复制失败" （显示红色背景和叉号）

## 错误处理

### 常见错误情况

1. **没有活跃标签页**
   - 错误信息：未找到活跃标签页
   - 解决方案：确保至少有一个标签页处于活跃状态

2. **系统页面**
   - 错误信息：无法复制系统页面
   - 解决方案：切换到普通网页标签页

3. **权限不足**
   - 错误信息：API Error
   - 解决方案：检查扩展权限设置

4. **没有有效标签页**
   - 错误信息：没有有效的标签页可复制
   - 解决方案：打开一些普通网页

## 技术实现

### 核心组件

1. **CopyButton 组件**
   - 可复用的复制按钮组件
   - 支持不同样式变体（primary/secondary）
   - 内置状态管理和用户反馈

2. **useTabCopy Hook**
   - 封装标签页复制逻辑
   - 提供 `copyActiveTab` 和 `copyAllTabs` 方法
   - 集成错误处理和日志记录

3. **标签页工具函数**
   - `getCurrentActiveTab()` - 获取当前活跃标签页
   - `getCurrentWindowTabs()` - 获取当前窗口所有标签页
   - `formatTabAsMarkdownLink()` - 格式化单个标签页
   - `formatTabsAsMarkdownList()` - 格式化标签页列表

### 权限要求

扩展需要以下权限：

```json
{
  "permissions": [
    "tabs"
  ]
}
```

### 浏览器兼容性

- ✅ Chrome/Chromium
- ✅ Edge
- ✅ Firefox（需要 WebExtensions API）

## 开发和测试

### 运行测试

```bash
# 运行所有测试
pnpm test

# 运行标签页功能测试
pnpm test test/tabs.test.ts
```

### 开发模式

```bash
# 启动开发服务器
pnpm dev
```

### 构建扩展

```bash
# 构建生产版本
pnpm build

# 创建ZIP包
pnpm zip
```

## 日志和调试

扩展集成了完整的日志系统：

- 开发环境：在浏览器控制台显示详细日志
- 生产环境：只记录警告和错误
- 支持远程日志上报（可选）

查看日志：
1. 打开浏览器开发者工具
2. 切换到 Console 标签
3. 执行复制操作查看日志输出

## 故障排除

### 按钮无响应
1. 检查浏览器控制台是否有错误信息
2. 确认扩展权限已正确授予
3. 尝试重新加载扩展

### 复制内容不正确
1. 检查标签页标题是否包含特殊字符
2. 确认URL格式正确
3. 查看控制台日志了解详细信息

### 性能问题
1. 检查是否有大量标签页（>100）
2. 关闭不必要的标签页
3. 重启浏览器

## 更新日志

### v1.0.0
- ✨ 新增：复制当前标签页功能
- ✨ 新增：复制所有标签页功能
- ✨ 新增：智能系统页面过滤
- ✨ 新增：完整的错误处理和用户反馈
- ✨ 新增：响应式设计和暗色主题支持
